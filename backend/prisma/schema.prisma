generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Game {
  id         String   @id @default(uuid())
  name       String
  platform   String   @default("steam")
  externalId String?  @unique // Steam AppID'sini burada tutacağız (Örn: "304390")
  imageUrl   String?  // Eğer scraper resim URL'ini bulursa buraya yazarız
  prices     Price[]
  deals      Deal?    
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
}

model Price {
  id        String   @id @default(uuid())
  amount    Float
  currency  String   @default("USD")
  source    String
  gameId    String
  game      Game     @relation(fields: [gameId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Deal {
  id              String   @id @default(uuid())
  oldPrice        Float
  newPrice        Float
  currency        String   @default("USD")
  dealScore       Int
  aiAnalysis      String?  // AI'nın yaptığı açıklama buraya gelecek
  gameId          String   @unique // Hatanın ana çözümü burası (Upsert için gerekli)
  game            Game     @relation(fields: [gameId], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt
}

model Subscription {
  id        String   @id @default(uuid())
  chatId    String   @unique // Telegram Chat ID - her kullanıcı tek subscription'a sahip
  gameIds   String[] // Favori oyun ID'leri
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}
